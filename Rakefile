desc "Remove cruft generated by compilation"
task :clean do
  files_to_clean = File.read('.gitignore').split("\n").map { |i| "**/#{i}"}
  p files_to_clean
  Dir.glob(files_to_clean).each do |file|
    rm file if !File.directory? file
  end
  system('rm -Rf tmp')
end

def version
  File.read("VERSION").chomp
end

desc "Compile MTASC"
task :compile do
  system("PATH=/usr/local/godi/bin:/usr/local/godi/sbin:$PATH && ocaml install.ml")
end

desc "Package MTASC for release"
task :package => :compile do
  system("rm -Rf pkg/#{version}") if File.exist?("pkg/#{version}")
  mkdir_p "pkg/#{version}"
  system("cp -R bin/mtasc* pkg/#{version}/")
  system("cp LICENSE pkg/#{version}/")
  system("cp LICENSE pkg/#{version}/")
  system("cp -R src/mtasc/std* pkg/#{version}/")
end

desc "Install MTASC to /usr/local"
task :install => :compile do
  system("rm /usr/local/bin/mtasc")
  system("cp bin/mtasc /usr/local/bin/mtasc-#{version}")
  system("ln -s /usr/local/bin/mtasc-#{version} /usr/local/bin/mtasc")
  system("cp -R src/mtasc/std* /usr/local/bin/")
end

task :default => :compile